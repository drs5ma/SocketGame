<html>

  <head>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
    <script src="js/three.min.js"></script>

  </head>



  <body>
    <script src="client.js"></script>
    <script>


  
      // Our Javascript will go here.
      var scene = new THREE.Scene();
      var width =  window.innerWidth;
      var height = window.innerHeight;
      //var camera = new THREE.PerspectiveCamera( 75,/, 0.1, 1000 );
      var camera = new THREE.OrthographicCamera( width / - 2, width / 2, height / 2, height / - 2, 1, 1000 );
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      document.body.appendChild( renderer.domElement );
      camera.position.z = 100;
      window.addEventListener('keydown', handleKeyDown, false);
      window.addEventListener('keyup', handleKeyUp, false);

      var geometry = new THREE.BoxGeometry( 20, 20, 20);
      var myColor = new THREE.Color(0xffffff*Math.random());
      var material = new THREE.MeshBasicMaterial( { color: myColor } );

      var my_start_position = new THREE.Vector3( 0, 1, 0 );

      var up_displacement = new THREE.Vector3( 0, 1, 0 );
      var down_displacement = new THREE.Vector3( 0, -1, 0 );
      var left_displacement = new THREE.Vector3( -1, 0, 0 );
      var right_displacement = new THREE.Vector3( 1, 0, 0 );

      var velocity = 10.0;

      //players = { {timestamp:, THREE.Object:}, {timestamp:, THREE.Object:} }
      //the actual objects view, (but this also holds the position data too.)
      var players = {};



      function handleKeyDown(event) {
        if (event.keyCode === 87) { //66 is "b"
          window.isWDown = true;
        }
        if (event.keyCode === 65) { //66 is "b"
          window.isADown = true;
        }
        if (event.keyCode === 83) { //66 is "b"
          window.isSDown = true;
        }
        if (event.keyCode === 68) { //66 is "b"
          window.isDDown = true;
        }
      }

      function handleKeyUp(event) {
        if (event.keyCode === 87) {
          window.isWDown = false;
        }
        if (event.keyCode === 65) {
          window.isADown = false;
        }
        if (event.keyCode === 83) {
          window.isSDown = false;
        }
        if (event.keyCode === 68) {
          window.isDDown = false;
        }
      }
      //creates a new cube at position, adds it to both the scene 
      // and adds it to the players object view
      function add_cube(cube_timestamp, position){

        var newbox = new THREE.Mesh( geometry, material );
        players[cube_timestamp] = newbox;
        scene.add(players[cube_timestamp]);
        players[cube_timestamp].position.set(position.x,position.y,position.z);

      }
      //displace the cube, update position, and return the new position
      function move_cube(cube_timestamp, displacement){

        var existing_cube = players[cube_timestamp];
        existing_cube.position.add(displacement);
        var new_position = existing_cube.position.clone();
        return new_position;
      }
      //remove the cube from both the server
      function remove_cube(cube_timestamp){
        scene.remove(players[cube_timestamp]);
        delete players[cube_timestamp];
      }

      var render = function () {
        requestAnimationFrame( render );
        //console.log(players);
        if(window.isWDown){
            send_server_move( up_displacement.clone().multiplyScalar(velocity ));
        }
        if(window.isSDown){
            send_server_move( down_displacement.clone().multiplyScalar(velocity) );
        }
        if(window.isADown){
            send_server_move( left_displacement.clone().multiplyScalar(velocity ));
        }
        if(window.isDDown){
            send_server_move( right_displacement.clone().multiplyScalar(velocity) );
        }
        renderer.render(scene, camera);
      };
      render();



    </script>
  </body>
</html>
